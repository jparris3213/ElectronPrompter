<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Product Window</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #000000;
        }
        .container {
            display: flex;
            width: 90%;
            /* Adjust width as needed */
        }
        .left-column {
            flex: 1;
            margin-right: 10px;
            align-items: left;
        }
        .right-column {
            flex: 1;
            display: flex;
            justify-content: right;
            align-items: right;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            color: white;
            font-size: 30px;
            text-align: left;
            /* Align text to the left */
            display: flex;
            justify-content: space-between;
            /* Space between name and price */
            margin-bottom: 10px;
            /* Space between items */
        }
        #timer {
            color: white;
            font-size: 80px;
        }
        #webcam {
            width: 100%;
            max-width: 1000px;
            height: auto;
            background-color: #333;
        }
        #webcam video {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-column">
            <ul>
                <li>
                    <div>
                        <div id="timer">00:00:00</div>
                        <button id="start">Start</button>
                        <button id="stop">Stop</button>
                        <button id="reset">Reset</button>
                    </div>
                </li>
            </ul>
            <ul id="placeholderList"></ul>
        </div>
        <div class="right-column">
            <div id="webcam">
                <video id="webcamVideo" autoplay></video>
                <select name="source" id="videoSource"></select>
            </div>
        </div>
    </div>
    <script>
        const { ipcRenderer } = require('electron');

        // Listen for the "start-timer" message
        ipcRenderer.on('start-timer', () => {
            console.log("Recieve");
            startTimer();
        });

        ipcRenderer.on('stop-timer', () => {
            console.log("Recieve");
            stopTimer();
        });

        ipcRenderer.on('reset-timer', () => {
            console.log("Recieve");
            resetTimer();
        });

        // Timer
        let timerInterval;
        let seconds = 0;

        function startTimer() {
            if (!timerInterval) { // Prevent multiple intervals if start is clicked more than once
                timerInterval = setInterval(() => {
                    seconds++;
                    document.getElementById('timer').innerText = formatTime(seconds);
                }, 1000);
            }
        }

        function stopTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        function resetTimer() {
            stopTimer(); // Stop the timer if it's running
            seconds = 0;
            document.getElementById('timer').innerText = "00:00:00";
        }

        function formatTime(sec) {
            const hours = Math.floor(sec / 3600);
            const minutes = Math.floor((sec - (hours * 3600)) / 60);
            const seconds = sec - (hours * 3600) - (minutes * 60);

            return [hours, minutes, seconds]
                .map(v => v < 10 ? "0" + v : v)
                .join(":");
        }

        document.getElementById('start').addEventListener('click', startTimer);
        document.getElementById('stop').addEventListener('click', stopTimer);
        document.getElementById('reset').addEventListener('click', resetTimer);

        const listElement = document.getElementById('placeholderList');

        // Fetch the JSON data
        fetch('prompt.json')
            .then(response => response.json())
            .then(data => {
                data.prompt.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<span>${item.Name}</span><span>${item.Price}</span>`; // Use innerHTML to include both name and price
                    listElement.appendChild(listItem);
                });
            })
            .catch(error => console.error('Error loading the JSON data:', error));

        // Access the webcam and stream the video to the video element
        const video = document.getElementById('webcamVideo');
        const videoSelect = document.getElementById('videoSource');

        function getStream() {
            if (window.stream) {
                window.stream.getTracks().forEach(track => {
                    track.stop();
                });
            }
            const videoSource = videoSelect.value;
            const constraints = {
                video: { deviceId: videoSource ? { exact: videoSource } : undefined }
            };
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    window.stream = stream;
                    video.srcObject = stream;
                })
                .catch(error => {
                    console.error('Error accessing the webcam:', error);
                });
        }

        function getDevices() {
            navigator.mediaDevices.enumerateDevices()
                .then(deviceInfos => {
                    for (let i = 0; i !== deviceInfos.length; ++i) {
                        const deviceInfo = deviceInfos[i];
                        const option = document.createElement('option');
                        option.value = deviceInfo.deviceId;
                        if (deviceInfo.kind === 'videoinput') {
                            option.text = deviceInfo.label || `Camera ${videoSelect.length + 1}`;
                            videoSelect.appendChild(option);
                        }
                    }
                })
                .catch(error => {
                    console.error('Error enumerating devices:', error);
                });
        }

        videoSelect.onchange = getStream;

        getDevices();
        getStream();
    </script>
</body>
</html>