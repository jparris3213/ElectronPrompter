<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Product Window</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
    <div style="display:flex; flex-direction:inline;">
        
        
        
        <div id="webcam"><div class="video-container">
            <video id="webcamVideo" autoplay></video>
            <div class="vertical-line" style="left: 25%;"></div>
            
            <div class="vertical-line" style="left: 75%;"></div>
        </div>
            <select name="source" id="videoSource" title="Select Video Source (OBS)" style="visibility: hidden;"></select>
        </div>
        <div id="timer">00:00:00</div>
    </div>
    
    <div class="left-column">
        
        <button id="start" style="visibility: hidden;">Start</button>
        <button id="stop" style="visibility: hidden;">Stop</button>
        <button id="reset" style="visibility: hidden;">Reset</button>
        <ul id="placeholderList"></ul>

    </div>
    <div class="right-column" style="visibility: hidden;">
        <ul id="placeholderList"></ul>
    </div>
</div>
<script>
    const { ipcRenderer } = require('electron');
    // Listen for the "start-timer" message
    ipcRenderer.on('start-timer', () => {
        console.log("Recieve");
        startTimer();
    });
    ipcRenderer.on('stop-timer', () => {
        console.log("Recieve");
        stopTimer();
    });
    ipcRenderer.on('reset-timer', () => {
        console.log("Recieve");
        resetTimer();
    });
    // Timer
    let timerInterval;
    let seconds = 0;
    function startTimer() {
        if (!timerInterval) { // Prevent multiple intervals if start is clicked more than once
            timerInterval = setInterval(() => {
                seconds++;
                document.getElementById('timer').innerText = formatTime(seconds);
            }, 1000);
        }
    }
    function stopTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
    }
    function resetTimer() {
        stopTimer(); // Stop the timer if it's running
        seconds = 0;
        document.getElementById('timer').innerText = "00:00:00";
    }
    function formatTime(sec) {
        const hours = Math.floor(sec / 3600);
        const minutes = Math.floor((sec - (hours * 3600)) / 60);
    const seconds = sec - (hours * 3600) - (minutes * 60);
    return [hours, minutes, seconds]
        .map(v => v < 10 ? "0" + v : v)
        .join(":");
}
document.getElementById('start').addEventListener('click', startTimer);
document.getElementById('stop').addEventListener('click', stopTimer);
document.getElementById('reset').addEventListener('click', resetTimer);
const listElement = document.getElementById('placeholderList');
// Fetch the JSON data
fetch('prompt.json')
        .then(response => response.json())
        .then(data => {
            data.prompt.forEach(item => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span>${item.Name}</span><span>${item.Price}</span>`; // Use innerHTML to include both name and price
                listElement.appendChild(listItem);
            });
        })
        .catch(error => console.error('Error loading the JSON data:', error));
    // Access the webcam and stream the video to the video element
    const video = document.getElementById('webcamVideo');
    const videoSelect = document.getElementById('videoSource');
    function getStream() {
        if (window.stream) {
            window.stream.getTracks().forEach(track => {
                track.stop();
            });
        }
        const videoSource = videoSelect.value;
        const constraints = {
            video: { deviceId: videoSource ? { exact: videoSource } : undefined }
        };
        navigator.mediaDevices.getUserMedia(constraints)
            .then(stream => {
                window.stream = stream;
                video.srcObject = stream;
            })
            .catch(error => {
                console.error('Error accessing the webcam:', error);
            });
    }
    function getDevices() {
        navigator.mediaDevices.enumerateDevices()
            .then(deviceInfos => {
                let obsCameraFound = false;
                for (let i = 0; i !== deviceInfos.length; ++i) {
                    const deviceInfo = deviceInfos[i];
                    const option = document.createElement('option');
                    option.value = deviceInfo.deviceId;
                    if (deviceInfo.kind === 'videoinput') {
                        option.text = deviceInfo.label || `Camera ${videoSelect.length + 1}`;
                        videoSelect.appendChild(option);
                        if (deviceInfo.label.includes("OBS Virtual Camera")) {
                            obsCameraFound = true;
                            videoSelect.value = deviceInfo.deviceId;
                        }
                    }
                }
                if (!obsCameraFound && videoSelect.options.length > 0) {
                    videoSelect.selectedIndex = 0;
                }
                getStream();
            })
            .catch(error => {
                console.error('Error enumerating devices:', error);
            });
    }
    videoSelect.onchange = getStream;
    getDevices();
    // Screen sharing
    const startScreenShareButton = document.getElementById('startScreenShare');
    const screenVideo = document.getElementById('screenVideo');
    startScreenShareButton.addEventListener('click', async () => {
        try {
            const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
            screenVideo.srcObject = stream;
        } catch (error) {
            console.error('Error sharing the screen:', error);
        }
    });
</script>
</body>
</html>